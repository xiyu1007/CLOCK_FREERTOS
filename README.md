# CLOCK_FREERTOS

## 硬件
- STM32F407VET6
- ESP32-C3 (wifi)
- DHT11 （温湿度传感器，单线 IIC 通信）
- TFT-LCD （2.4 存显示屏）
  
## 硬件购买链接（仅供参考）
- 【淘宝】7 天无理由退货 https://e.tb.cn/h.7RU1kElLxTqdZ8K?tk=Ab2rU1jKBFI CZ356 「STM32F407VET6 开发板 Cortex-M4 STM32 小型系统板 ARM 学习核心板」
- 【淘宝】假一赔四 https://e.tb.cn/h.7itv9UN40JIytxq?tk=hW2ZU1jKBrZ CZ356 「DHT11温湿度传感器单总线模块数字开关电子积木 DHT11传感器」
- 【淘宝】7 天无理由退货 https://e.tb.cn/h.7RMLOCeIlG7B3Tv?tk=ITk5U1jrfMG HU591 「ESP32-C3 开发板_简约/经典版 Wi-Fi 蓝牙编程学习控制器核心板模块」
- TFT-LCD 拼多多 https://mobile.yangkeduo.com/goods1.html?ps=jK0xIbUlGZ

## 引脚连接定义位置

| 模块      | 修改的文件                     | 主要配置项                             | 注意事项           |
| ------- | ------------------------- | --------------------------------- | -------------- |
| TFT-LCD | TFT_LCD.h                 | TFT_LCD_SPIx, TFT_LCD_PORT, 引脚宏定义 | 确保引脚支持复用功能     |
| DMA传输   | TFT_LCD.h + ST7789_Init() | TFT_DMA_Stream/Channel/RCC        | 不同SPI对应不同DMA   |
| 日志串口    | u_usart.h                 | SERIAL_USART* 系列宏定义               | 与AT串口使用不同USART |
| AT串口    | AT相关头文件                   | AT_USART* 系列宏定义                   | 不使用中断/DMA      |
| DHT11   | DHT11.h                   | DHT11_PORT, DHT11_PIN             | 单线时序敏感         |

| 模块              | 外设 / 端口        | MCU 引脚                | 连接对象            | 连接类型            | 说明             | 修改位置                    |
| --------------- | -------------- | --------------------- | --------------- | --------------- | -------------- | ----------------------- |
| TFT-LCD（ST7789） | SPI1 / GPIOA   | PA5 (SPI1_SCK)        | TFT-LCD SCK     | 实体连线            | SPI 时钟         | TFT_LCD.h               |
|                 | SPI1 / GPIOA   | PA7 (SPI1_MOSI)       | TFT-LCD MOSI    | 实体连线            | SPI 数据输出       | TFT_LCD.h               |
|                 | SPI1 / GPIOA   | PA6 (SPI1_MISO)       | TFT-LCD MISO    | 实体连线（可选）        | SPI 数据输入（通常不用） | TFT_LCD.h               |
|                 | GPIOA          | PA4 (GPIO)            | TFT-LCD CS      | 实体连线            | 片选信号           | TFT_LCD.h               |
|                 | GPIOA          | PA3 (GPIO)            | TFT-LCD DC / RS | 实体连线            | 数据/命令选择        | TFT_LCD.h               |
|                 | GPIOA          | PA2 (GPIO)            | TFT-LCD RST     | 实体连线            | 显示复位           | TFT_LCD.h               |
| SPI1 DMA（发送）    | DMA2           | DMA2 Stream3 Channel3 | SPI1 TX         | **逻辑连接（无物理连线）** | 内存 → SPI 数据寄存器 | TFT_LCD.h / ST7789_Init |
| 日志串口            | USART2 / GPIOD | PD5 (USART2_TX)       | 调试器 RX          | 实体连线            | 日志输出           | u_usart.h               |
|                 | USART2 / GPIOD | PD6 (USART2_RX)       | 调试器 TX          | 实体连线            | 命令输入           | u_usart.h               |
| 日志串口 DMA        | DMA1           | DMA1 Stream5 Channel4 | USART2 RX       | **逻辑连接（无物理连线）** | 串口接收 DMA       | u_usart.h               |
| AT 指令串口（WiFi）   | USART1 / GPIOA | PA9 (USART1_TX)       | ESP32 RX        | 实体连线            | MCU → ESP32    | AT_xxx.h                |
|                 | USART1 / GPIOA | PA10 (USART1_RX)      | ESP32 TX        | 实体连线            | ESP32 → MCU    | AT_xxx.h                |
| DHT11 传感器       | GPIOE          | PE2 (GPIO)            | DHT11 DATA      | 实体连线            | 单线通信（需上拉）      | DHT11.h                 |


```cpp
┌─────────────────────────────────────────────────────────────────────────────────────┐
│                                STM32 主控芯片                                        │
│                                                                                     │
├─────────────────────────────────────────────────────────────────────────────────────┤
│      TFT-LCD（ST7789）SPI1 + 控制引脚            │ 修改位置：TFT_LCD.h                │
│  ┌─────────────────────────────────────────┐    │ ┌──────────────────────────┐      │
│  │ GPIOA / SPI1                            │    │ │ ? TFT_LCD_SPIx           │      │
│  │                                         │    │ │ ? TFT_LCD_PORT           │      │
│  │ ? PA5  (SPI1_SCK)  ────┐                │    │ │ ? TFT_LCD_SCK/MOSI/MISO/CS│     │
│  │                                        │    │ │ ? TFT_LCD_DC/RST         │      │
│  │ ? PA7  (SPI1_MOSI) ────┐                │    │ └──────────────────────────┘      │
│  │                                        │    │                                   │
│  │ ? PA4  (GPIO_CS)  ─────┐                │    │                                   │
│  │                                        │    │                                   │
│  │ ? PA3  (GPIO_DC)  ─────┐                │    │                                   │
│  │                                        │    │                                   │
│  │ ? PA2  (GPIO_RST) ─────┐                │    │                                   │
│  │                                        │    │                                   │
│  └───────────────────────┬─────────────────┘    │                                   │
│                          │                      │                                   │
│  ┌────────────────────────────────────────────┐                                    │
│  │         TFT-LCD 模块 ： GPIOA                │                                    │
│  │  ? SCK   ← PA5                              │                                    │
│  │  ? MOSI  ← PA7                              │                                    │
│  │  ? CS    ← PA4                              │                                    │
│  │  ? DC    ← PA3                              │                                    │
│  │  ? RST   ← PA2                              │                                    │
│  └─────────────────────────────────────────────┘                                    │
│                                                                                     │
├─────────────────────────────────────────────────────────────────────────────────────┤
│ SPI1 DMA 发送（逻辑连接）                 │ 修改位置：TFT_LCD.h / ST7789_Init()       │
│  ┌────────────────────────────────────┐ │ ┌──────────────────────────┐              │
│  │ ? DMA2 Stream3 Channel3 ───┐       │ │ │ ? TFT_DMA_Stream        │               │
│  │                                   │ │ │ ? TFT_DMA_Channel       │               │
│  │                          SPI1 TX   │ │ │ ? TFT_DMA_RCC           │               │
│  │      （内存 → SPI数据寄存器）        │ │ └──────────────────────────┘              │
│  └────────────────────────────────────┘ │                                           │
│                                                                                     │
├─────────────────────────────────────────────────────────────────────────────────────┤
│  USART2 日志串口（调试）               │ 修改位置：u_usart.h                          │
│  ┌───────────────────────────────────┐  │ ┌─────────────────────────────┐           │
│  │ GPIOD / USART2                    │  │ │ ? SERIAL_USART              │           │
│  │                                   │  │ │ ? SERIAL_USART_PORT         │           │
│  │ ? PD5 (USART2_TX) ───┐            │  │ │ ? SERIAL_USART_TX/RX        │           │
│  │                                  │  │ │ ? SERIAL_DMA_RX_STREAM      │           │
│  │                   调试器 RX       │  │ │ ? SERIAL_DMA_RX_CHANNEL     │           │
│  │                                   │  │ │ ? SERIAL_DMA_RX_RCC         │           │
│  │ ? PD6 (USART2_RX) ───┐            │  │ └─────────────────────────────┘           │
│  │                                  │  │                                           │
│  │                   调试器 TX       │  │                                            │
│  │                                   │  │                                           │
│  │ ? DMA1 Stream5 Channel4 ───┐      │  │                                           │
│  │                                  │  │                                           │
│  │                         USART2 RX │  │                                           │
│  └───────────────────────────────────┘  │                                           │
│                                                                                     │
├─────────────────────────────────────────────────────────────────────────────────────┤
│  USART1 AT 指令串口（WiFi）              │ 修改位置：AT相关头文件                      │
│  ┌───────────────────────────────────┐  │ ┌─────────────────────────┐               │
│  │ GPIOA / USART1                    │  │ │ ? AT_USART              │               │
│  │                                   │  │ │ ? AT_USART_PORT         │               │
│  │ ? PA9  (USART1_TX) ───┐           │  │ │ ? AT_USART_TX/RX        │               │
│  │                                  │  │ └─────────────────────────┘               │
│  │                   ESP32 RX        │  │                                           │
│  │                                   │  │ 注意：                                     │
│  │ ? PA10 (USART1_RX) ───┐           │  │ ? 不使用中断和DMA                          │
│  │                                  │  │ ? 不可与日志串口共用                       │
│  │                   ESP32 TX        │  │                                           │
│  └───────────────────────────────────┘  │                                           │
│                                                                                     │
├─────────────────────────────────────────────────────────────────────────────────────┤
│  DHT11 温湿度传感器                    │ 修改位置：DHT11.h                            │
│  ┌───────────────────────────────────┐  │ ┌─────────────────────────┐               │
│  │ GPIOE                             │  │ │ ? DHT11_PORT            │               │
│  │ ? PE2 (GPIO) ────────┐            │  │ │ ? DHT11_PIN             │               │
│  │                                  │  │ └─────────────────────────┘               │
│  │                  DHT11 DATA       │  │                                           │
│  └───────────────────────────────────┘  │                                           │
│                                                                                     │
└─────────────────────────────────────────────────────────────────────────────────────┘
```
